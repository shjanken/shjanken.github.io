<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>二手车数据分析 | shjanken's 兴趣小窝</title><meta name=viewport content="width=device-width,minimum-scale=1"><meta name=description content="引用 康康，这里面是两层意思，一个意思是统计二一年买进以后，然后这个三个月内卖掉的这个数量，那么其中分单位和个人，还有一个数字是在这个里面要去掉这个洗牌的因素，也就是说一般来讲，这个一年交易三次的，就是洗牌的这个意思。在这个数量里面，那么交易了三两的个人和单位是多少
2021年，购买且持有3个月内的数量，分个人和单位 其中一年内交易3次及以上的数量分个人和单位。 车辆类型为小微型载客，使用性质为非营运、营转非，出租转非，预约岀租转非。
分析 2021 年过户车辆中的多次交易车辆 (洗澡车) 使用 python 和 pandas 分析 2021 年的交易数据 查询3个月内交易的车辆数据, 并且排除一年内多次交易的车辆(洗澡车)
准备原始数据 从数据库中查找所有 2021 年 1 月到 2022 年 3 月份的交易记录
sql = &#34;&#34;&#34; select xh, slrq, yw, syq, hphm from ylrjy where slrq between to_date('20210101','YYYYMMDD') and to_date('20220401', 'YYYYMMDD') and ysyxz in('A','L','M','U') and substr(cllx,1,2) in('K3','K4') order by slrq &#34;&#34;&#34; cursor = connection.cursor() cursor.execute(sql) results = cursor.fetchall() 从 2021 年 1 月到 2022 年 3 月的所有交易过的车辆数据 将数据库中读取到的数据创建为 pandas DataFrame, 方便后续的分析"><meta name=generator content="Hugo 0.104.2"><meta name=robots content="noindex, nofollow"><link rel=stylesheet href=/ananke/css/main.min.css><meta property="og:title" content="二手车数据分析"><meta property="og:description" content="引用 康康，这里面是两层意思，一个意思是统计二一年买进以后，然后这个三个月内卖掉的这个数量，那么其中分单位和个人，还有一个数字是在这个里面要去掉这个洗牌的因素，也就是说一般来讲，这个一年交易三次的，就是洗牌的这个意思。在这个数量里面，那么交易了三两的个人和单位是多少
2021年，购买且持有3个月内的数量，分个人和单位 其中一年内交易3次及以上的数量分个人和单位。 车辆类型为小微型载客，使用性质为非营运、营转非，出租转非，预约岀租转非。
分析 2021 年过户车辆中的多次交易车辆 (洗澡车) 使用 python 和 pandas 分析 2021 年的交易数据 查询3个月内交易的车辆数据, 并且排除一年内多次交易的车辆(洗澡车)
准备原始数据 从数据库中查找所有 2021 年 1 月到 2022 年 3 月份的交易记录
sql = &#34;&#34;&#34; select xh, slrq, yw, syq, hphm from ylrjy where slrq between to_date('20210101','YYYYMMDD') and to_date('20220401', 'YYYYMMDD') and ysyxz in('A','L','M','U') and substr(cllx,1,2) in('K3','K4') order by slrq &#34;&#34;&#34; cursor = connection.cursor() cursor.execute(sql) results = cursor.fetchall() 从 2021 年 1 月到 2022 年 3 月的所有交易过的车辆数据 将数据库中读取到的数据创建为 pandas DataFrame, 方便后续的分析"><meta property="og:type" content="article"><meta property="og:url" content="https://shjanken.github.io/posts/%E4%BA%8C%E6%89%8B%E8%BD%A6%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/"><meta property="article:section" content="posts"><meta itemprop=name content="二手车数据分析"><meta itemprop=description content="引用 康康，这里面是两层意思，一个意思是统计二一年买进以后，然后这个三个月内卖掉的这个数量，那么其中分单位和个人，还有一个数字是在这个里面要去掉这个洗牌的因素，也就是说一般来讲，这个一年交易三次的，就是洗牌的这个意思。在这个数量里面，那么交易了三两的个人和单位是多少
2021年，购买且持有3个月内的数量，分个人和单位 其中一年内交易3次及以上的数量分个人和单位。 车辆类型为小微型载客，使用性质为非营运、营转非，出租转非，预约岀租转非。
分析 2021 年过户车辆中的多次交易车辆 (洗澡车) 使用 python 和 pandas 分析 2021 年的交易数据 查询3个月内交易的车辆数据, 并且排除一年内多次交易的车辆(洗澡车)
准备原始数据 从数据库中查找所有 2021 年 1 月到 2022 年 3 月份的交易记录
sql = &#34;&#34;&#34; select xh, slrq, yw, syq, hphm from ylrjy where slrq between to_date('20210101','YYYYMMDD') and to_date('20220401', 'YYYYMMDD') and ysyxz in('A','L','M','U') and substr(cllx,1,2) in('K3','K4') order by slrq &#34;&#34;&#34; cursor = connection.cursor() cursor.execute(sql) results = cursor.fetchall() 从 2021 年 1 月到 2022 年 3 月的所有交易过的车辆数据 将数据库中读取到的数据创建为 pandas DataFrame, 方便后续的分析"><meta itemprop=wordCount content="1112"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="二手车数据分析"><meta name=twitter:description content="引用 康康，这里面是两层意思，一个意思是统计二一年买进以后，然后这个三个月内卖掉的这个数量，那么其中分单位和个人，还有一个数字是在这个里面要去掉这个洗牌的因素，也就是说一般来讲，这个一年交易三次的，就是洗牌的这个意思。在这个数量里面，那么交易了三两的个人和单位是多少
2021年，购买且持有3个月内的数量，分个人和单位 其中一年内交易3次及以上的数量分个人和单位。 车辆类型为小微型载客，使用性质为非营运、营转非，出租转非，预约岀租转非。
分析 2021 年过户车辆中的多次交易车辆 (洗澡车) 使用 python 和 pandas 分析 2021 年的交易数据 查询3个月内交易的车辆数据, 并且排除一年内多次交易的车辆(洗澡车)
准备原始数据 从数据库中查找所有 2021 年 1 月到 2022 年 3 月份的交易记录
sql = &#34;&#34;&#34; select xh, slrq, yw, syq, hphm from ylrjy where slrq between to_date('20210101','YYYYMMDD') and to_date('20220401', 'YYYYMMDD') and ysyxz in('A','L','M','U') and substr(cllx,1,2) in('K3','K4') order by slrq &#34;&#34;&#34; cursor = connection.cursor() cursor.execute(sql) results = cursor.fetchall() 从 2021 年 1 月到 2022 年 3 月的所有交易过的车辆数据 将数据库中读取到的数据创建为 pandas DataFrame, 方便后续的分析"></head><body class="ma0 avenir bg-near-white"><header><div class=bg-black><nav class="pv3 ph3 ph4-ns" role=navigation><div class="flex-l justify-between items-center center"><a href=/ class="f3 fw2 hover-white no-underline white-90 dib">shjanken's 兴趣小窝</a><div class="flex-l items-center"><div class=ananke-socials></div></div></div></nav></div></header><main class=pb7 role=main><article class="flex-l flex-wrap justify-between mw8 center ph3"><header class="mt4 w-100"><aside class="instapaper_ignoref b helvetica tracked">POSTS</aside><div id=sharing class="mt3 ananke-socials"></div><h1 class="f1 athelas mt3 mb1">二手车数据分析</h1><p class=tracked>By <strong><a href=mailto:janken.wang@hotmail.com>janken.wang@hotmail.com</a></strong></p></header><div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><h2 id=引用>引用</h2><blockquote><p>康康，这里面是两层意思，一个意思是统计二一年买进以后，然后这个三个月内卖掉的这个数量，那么其中分单位和个人，还有一个数字是在这个里面要去掉这个洗牌的因素，也就是说一般来讲，这个一年交易三次的，就是洗牌的这个意思。在这个数量里面，那么交易了三两的个人和单位是多少</p></blockquote><blockquote><p>2021年，购买且持有3个月内的数量，分个人和单位
其中一年内交易3次及以上的数量分个人和单位。
车辆类型为小微型载客，使用性质为非营运、营转非，出租转非，预约岀租转非。</p></blockquote><h2 id=分析-2021-年过户车辆中的多次交易车辆--洗澡车>分析 2021 年过户车辆中的多次交易车辆 (洗澡车)</h2><p>使用 <code>python</code> 和 <code>pandas</code> 分析 2021 年的交易数据
查询3个月内交易的车辆数据, 并且排除一年内多次交易的车辆(洗澡车)</p><h3 id=准备原始数据>准备原始数据</h3><p>从数据库中查找所有 2021 年 1 月到 2022 年 3 月份的交易记录</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>sql <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>select xh, slrq, yw, syq, hphm from ylrjy
</span></span></span><span style=display:flex><span><span style=color:#e6db74>where slrq between to_date(&#39;20210101&#39;,&#39;YYYYMMDD&#39;) and to_date(&#39;20220401&#39;, &#39;YYYYMMDD&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>and ysyxz in(&#39;A&#39;,&#39;L&#39;,&#39;M&#39;,&#39;U&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>and substr(cllx,1,2) in(&#39;K3&#39;,&#39;K4&#39;)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>order by slrq
</span></span></span><span style=display:flex><span><span style=color:#e6db74>&#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cursor <span style=color:#f92672>=</span> connection<span style=color:#f92672>.</span>cursor()
</span></span><span style=display:flex><span>cursor<span style=color:#f92672>.</span>execute(sql)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>results <span style=color:#f92672>=</span> cursor<span style=color:#f92672>.</span>fetchall()
</span></span></code></pre></div><h3 id=从-2021-年-1-月到-2022-年-3-月的所有交易过的车辆数据>从 2021 年 1 月到 2022 年 3 月的所有交易过的车辆数据</h3><p>将数据库中读取到的数据创建为 <code>pandas DataFrame</code>, 方便后续的分析</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> pandas <span style=color:#66d9ef>as</span> pd
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>original_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>DataFrame(results,columns<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;xh&#39;</span>, <span style=color:#e6db74>&#39;slrq&#39;</span>, <span style=color:#e6db74>&#39;yw&#39;</span>, <span style=color:#e6db74>&#39;syq&#39;</span>, <span style=color:#e6db74>&#39;hphm&#39;</span>])
</span></span><span style=display:flex><span>original_df
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm
</span></span><span style=display:flex><span>0       31000012462935 2021-01-04 08:20:54  C1   2    None
</span></span><span style=display:flex><span>1       31000006090006 2021-01-04 08:26:29  B5   2  FMS296
</span></span><span style=display:flex><span>2       31011918169311 2021-01-04 08:26:38  C1   2    None
</span></span><span style=display:flex><span>3       31000012074570 2021-01-04 08:27:41  B3   2  C3C1B8
</span></span><span style=display:flex><span>4       31111116241507 2021-01-04 08:27:55  B4   2  C0F6Z6
</span></span><span style=display:flex><span>...                ...                 ...  ..  ..     ...
</span></span><span style=display:flex><span>505741  31000007560531 2022-03-31 10:36:35  B5   2  EQY753
</span></span><span style=display:flex><span>505742  31000007140735 2022-03-31 10:38:11  B5   2  FUC803
</span></span><span style=display:flex><span>505743  31000016463301 2022-03-31 11:07:39  C1   2    None
</span></span><span style=display:flex><span>505744  31000012155246 2022-03-31 12:23:35  B5   2  DVU181
</span></span><span style=display:flex><span>505745  31090312358733 2022-03-31 12:26:16  C1   2    None
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[505746 rows x 5 columns]
</span></span></code></pre></div><p>一共有 <strong>505747</strong> 条数据</p><h3 id=2021-年购买且持有3个月以内的车辆>2021 年购买且持有3个月以内的车辆</h3><p>过滤交易列表. 获取3个月交易过的车辆数据</p><ol><li>根据 xh 分组</li><li>如果小组里面的数据只有一条, 则直接将数据去除, 因为这个车子没有再次交易过</li><li>每个小组里面的记录按照 slrq 升序排序</li><li>排序之后的数据, 如果第一条记录不是 B3, B4 或者 B5, 并且不是在 2022 年 01 01 日之前的, 直接将这组数据去除</li><li>计算小组中每条数据和前一条数据之间的间隔, 如果没有任何一条数据和之前的数据间隔在3个月之内的, 去除这组数据</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>is_trade_in_three_month</span>(trade_record):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> len(trade_record) <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    trade_record<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;slrq&#39;</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> trade_record[<span style=color:#e6db74>&#39;yw&#39;</span>]<span style=color:#f92672>.</span>head(<span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>isin([<span style=color:#e6db74>&#39;B3&#39;</span>, <span style=color:#e6db74>&#39;B4&#39;</span>, <span style=color:#e6db74>&#39;B5&#39;</span>])<span style=color:#f92672>.</span>bool():
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>False</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> trade_record[<span style=color:#e6db74>&#39;slrq&#39;</span>]<span style=color:#f92672>.</span>diff()<span style=color:#f92672>.</span>apply(<span style=color:#66d9ef>lambda</span> td: td <span style=color:#f92672>&lt;</span> np<span style=color:#f92672>.</span>timedelta64(<span style=color:#ae81ff>3</span>, <span style=color:#e6db74>&#34;M&#34;</span>))<span style=color:#f92672>.</span>any()
</span></span><span style=display:flex><span>trade_in_three_month_df <span style=color:#f92672>=</span> original_df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;xh&#39;</span>)<span style=color:#f92672>.</span>filter(is_trade_in_three_month)
</span></span><span style=display:flex><span>trade_in_three_month_df<span style=color:#f92672>.</span>sort_values(by<span style=color:#f92672>=</span>[<span style=color:#e6db74>&#39;xh&#39;</span>, <span style=color:#e6db74>&#39;slrq&#39;</span>])
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm
</span></span><span style=display:flex><span>43559   11000005074685 2021-02-20 14:51:34  B4   2  C1898V
</span></span><span style=display:flex><span>57293   11000005074685 2021-03-04 08:43:57  C1   2    None
</span></span><span style=display:flex><span>247065  11000006012033 2021-08-03 08:31:55  B4   1  C91X51
</span></span><span style=display:flex><span>310483  11000006012033 2021-09-24 11:07:26  C1   2    None
</span></span><span style=display:flex><span>23241   11000006046781 2021-01-22 09:55:38  B4   1  C2J3G6
</span></span><span style=display:flex><span>...                ...                 ...  ..  ..     ...
</span></span><span style=display:flex><span>18603   65010013016486 2021-01-18 15:20:08  B4   1  C2017E
</span></span><span style=display:flex><span>59876   65010013016486 2021-03-05 11:07:16  B5   2  A31N52
</span></span><span style=display:flex><span>448024  65010013016486 2022-01-18 14:03:44  C1   2    None
</span></span><span style=display:flex><span>410457  65010018098829 2021-12-20 10:07:31  B4   1  C150RZ
</span></span><span style=display:flex><span>457059  65010018098829 2022-01-26 10:37:54  B3   2  C8V9L5
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[207952 rows x 5 columns]
</span></span></code></pre></div><p>将这些数据按照 xh 去重.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_in_three_month_df<span style=color:#f92672>.</span>drop_duplicates(<span style=color:#e6db74>&#39;xh&#39;</span>)<span style=color:#f92672>.</span>sort_values(<span style=color:#e6db74>&#39;xh&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm
</span></span><span style=display:flex><span>43559   11000005074685 2021-02-20 14:51:34  B4   2  C1898V
</span></span><span style=display:flex><span>247065  11000006012033 2021-08-03 08:31:55  B4   1  C91X51
</span></span><span style=display:flex><span>23241   11000006046781 2021-01-22 09:55:38  B4   1  C2J3G6
</span></span><span style=display:flex><span>343267  11000006048372 2021-10-25 12:14:35  B4   1  C0628J
</span></span><span style=display:flex><span>39014   11000007042522 2021-02-05 14:14:41  B4   1  C9592R
</span></span><span style=display:flex><span>...                ...                 ...  ..  ..     ...
</span></span><span style=display:flex><span>210997  64010014276368 2021-07-02 10:45:26  B4   1  C10M66
</span></span><span style=display:flex><span>53934   64010015274180 2021-03-02 09:44:45  B4   2  CQ6181
</span></span><span style=display:flex><span>481443  64010020042118 2022-02-28 12:39:55  B4   1  C157G7
</span></span><span style=display:flex><span>18603   65010013016486 2021-01-18 15:20:08  B4   1  C2017E
</span></span><span style=display:flex><span>410457  65010018098829 2021-12-20 10:07:31  B4   1  C150RZ
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[93339 rows x 5 columns]
</span></span></code></pre></div><p>这些不重复的数据就是3个月内交易的车辆. 按照 syq 分组</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_in_three_month_df<span style=color:#f92672>.</span>drop_duplicates(<span style=color:#e6db74>&#39;xh&#39;</span>)<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;syq&#39;</span>)[<span style=color:#e6db74>&#39;syq&#39;</span>]<span style=color:#f92672>.</span>count()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>syq
</span></span><span style=display:flex><span>1    62358
</span></span><span style=display:flex><span>2    30981
</span></span><span style=display:flex><span>Name: syq, dtype: int64
</span></span></code></pre></div><h3 id=2021-年-3-个月内交易的车辆中的多次交易车辆>2021 年 3 个月内交易的车辆中的多次交易车辆</h3><p>为了统计方便, 将记录总数作为一列添加到 <code>trade_in_three_month_df</code> 数据表上</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_cnt_ser <span style=color:#f92672>=</span> trade_in_three_month_df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;xh&#39;</span>)[<span style=color:#e6db74>&#39;xh&#39;</span>]<span style=color:#f92672>.</span>transform(<span style=color:#e6db74>&#39;count&#39;</span>)
</span></span><span style=display:flex><span>trade_in_three_month_with_cnt_df <span style=color:#f92672>=</span> trade_in_three_month_df<span style=color:#f92672>.</span>copy()
</span></span><span style=display:flex><span>trade_in_three_month_with_cnt_df[<span style=color:#e6db74>&#39;trade_cnt&#39;</span>] <span style=color:#f92672>=</span> trade_cnt_ser
</span></span><span style=display:flex><span>trade_in_three_month_with_cnt_df
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm  trade_cnt
</span></span><span style=display:flex><span>1       31000006090006 2021-01-04 08:26:29  B5   2  FMS296          2
</span></span><span style=display:flex><span>12      31000012159706 2021-01-04 08:33:36  B4   1  C6A6Z9          2
</span></span><span style=display:flex><span>13      31000015389254 2021-01-04 08:34:40  B4   1  C98898          2
</span></span><span style=display:flex><span>21      31000009464622 2021-01-04 08:38:51  B4   1  CF6735          2
</span></span><span style=display:flex><span>37      31090311109571 2021-01-04 08:46:27  B4   1  C2W1D7          2
</span></span><span style=display:flex><span>...                ...                 ...  ..  ..     ...        ...
</span></span><span style=display:flex><span>505737  31000009583074 2022-03-31 09:51:28  C1   2    None          2
</span></span><span style=display:flex><span>505738  31000007118737 2022-03-31 09:53:33  C1   2    None          2
</span></span><span style=display:flex><span>505739  31000013537154 2022-03-31 09:55:39  C1   2    None          2
</span></span><span style=display:flex><span>505741  31000007560531 2022-03-31 10:36:35  B5   2  EQY753         34
</span></span><span style=display:flex><span>505742  31000007140735 2022-03-31 10:38:11  B5   2  FUC803         61
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[207952 rows x 6 columns]
</span></span></code></pre></div><p>从上面3个月内交易的报表中. 统计每个 xh 交易的数量, 去掉 <code>trade_cnt</code> 小于3的数据</p><ol><li>数据表按照 xh 分组</li><li>分组以后的数据去掉 <code>trade_cnt</code> 小于3的数据\</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_more_than_three_times_df <span style=color:#f92672>=</span> trade_in_three_month_with_cnt_df<span style=color:#f92672>.</span>query(<span style=color:#e6db74>&#39;trade_cnt &gt; 3&#39;</span>)
</span></span><span style=display:flex><span>trade_more_than_three_times_df<span style=color:#f92672>.</span>sort_values([<span style=color:#e6db74>&#39;xh&#39;</span>, <span style=color:#e6db74>&#39;slrq&#39;</span>])<span style=color:#f92672>.</span>head(<span style=color:#ae81ff>50</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm  trade_cnt
</span></span><span style=display:flex><span>39014   11000007042522 2021-02-05 14:14:41  B4   1  C9592R          4
</span></span><span style=display:flex><span>192329  11000007042522 2021-06-18 13:00:11  B5   2  DJB602          4
</span></span><span style=display:flex><span>253436  11000007042522 2021-08-09 08:42:56  B5   2  FZR123          4
</span></span><span style=display:flex><span>443707  11000007042522 2022-01-14 12:20:06  B4   2  C970P5          4
</span></span><span style=display:flex><span>93118   11000009028070 2021-03-30 10:47:43  B4   2  CAC000          4
</span></span><span style=display:flex><span>225114  11000009028070 2021-07-14 11:06:33  B5   2  FDR167          4
</span></span><span style=display:flex><span>282856  11000009028070 2021-08-31 14:34:40  B4   1  CDD727          4
</span></span><span style=display:flex><span>292621  11000009028070 2021-09-08 09:59:37  C1   2    None          4
</span></span><span style=display:flex><span>106488  11000009041559 2021-04-09 15:19:24  B5   2  DBF053          5
</span></span><span style=display:flex><span>194417  11000009041559 2021-06-21 12:57:18  B4   2  CYM919          5
</span></span><span style=display:flex><span>216792  11000009041559 2021-07-07 10:49:37  B5   2  BFK802          5
</span></span><span style=display:flex><span>232181  11000009041559 2021-07-20 13:04:00  B4   2  C7B316          5
</span></span><span style=display:flex><span>258517  11000009041559 2021-08-11 14:17:26  B5   2  EUK030          5
</span></span><span style=display:flex><span>47129   11000010104070 2021-02-24 10:13:22  B4   1  C8L5A9          4
</span></span><span style=display:flex><span>59533   11000010104070 2021-03-05 09:59:47  B3   2  C2X8Z7          4
</span></span><span style=display:flex><span>103431  11000010104070 2021-04-08 09:34:50  B5   1  BLT500          4
</span></span><span style=display:flex><span>271064  11000010104070 2021-08-23 12:43:27  B5   2  ASQ296          4
</span></span><span style=display:flex><span>79585   11010014408109 2021-03-19 10:09:11  B4   1  CF022H          4
</span></span><span style=display:flex><span>143012  11010014408109 2021-05-11 10:17:00  B5   2  DMD221          4
</span></span><span style=display:flex><span>264204  11010014408109 2021-08-17 10:23:08  B4   1  C2P5Y1          4
</span></span><span style=display:flex><span>287910  11010014408109 2021-09-03 16:02:23  B5   2  B57A96          4
</span></span><span style=display:flex><span>1200    11010014588569 2021-01-04 13:11:47  B3   2  C1Y8Q9          4
</span></span><span style=display:flex><span>14109   11010014588569 2021-01-14 10:51:36  B5   1  DXL039          4
</span></span><span style=display:flex><span>275033  11010014588569 2021-08-25 12:59:44  B4   2  C223ZK          4
</span></span><span style=display:flex><span>468134  11010014588569 2022-02-16 12:46:14  B3   1  C5R9W9          4
</span></span><span style=display:flex><span>59885   11010016160242 2021-03-05 11:09:26  B4   2  CL0353          6
</span></span><span style=display:flex><span>64027   11010016160242 2021-03-09 09:33:17  B5   2  FEQ297          6
</span></span><span style=display:flex><span>158506  11010016160242 2021-05-24 10:16:03  B4   2  C575H1          6
</span></span><span style=display:flex><span>172028  11010016160242 2021-06-02 11:12:58  B3   2  CHL969          6
</span></span><span style=display:flex><span>242655  11010016160242 2021-07-29 13:04:47  B3   1  C1R0K6          6
</span></span><span style=display:flex><span>291845  11010016160242 2021-09-07 14:03:15  B5   2  B7L555          6
</span></span><span style=display:flex><span>129444  11010016713317 2021-04-27 11:14:57  B4   2  C010V0          5
</span></span><span style=display:flex><span>136589  11010016713317 2021-05-06 14:23:19  B3   2  C1E977          5
</span></span><span style=display:flex><span>178236  11010016713317 2021-06-07 14:12:17  B5   2  EUP096          5
</span></span><span style=display:flex><span>226758  11010016713317 2021-07-15 11:43:53  B4   2  C8M168          5
</span></span><span style=display:flex><span>271157  11010016713317 2021-08-23 12:55:36  B3   2  C311AX          5
</span></span><span style=display:flex><span>253307  11010207024314 2021-08-06 15:30:36  B4   1  C9F0D6          4
</span></span><span style=display:flex><span>257021  11010207024314 2021-08-10 14:30:00  B5   2  FHS062          4
</span></span><span style=display:flex><span>260265  11010207024314 2021-08-13 09:19:05  B4   1  C075ER          4
</span></span><span style=display:flex><span>271936  11010207024314 2021-08-23 15:07:02  C1   2    None          4
</span></span><span style=display:flex><span>174460  12000018252163 2021-06-03 14:45:52  B5   1  DLV176          4
</span></span><span style=display:flex><span>294889  12000018252163 2021-09-09 13:16:40  B4   1  CEU079          4
</span></span><span style=display:flex><span>372842  12000018252163 2021-11-17 14:05:35  B5   2  DRH009          4
</span></span><span style=display:flex><span>409134  12000018252163 2021-12-17 09:17:39  B4   2  C217GP          4
</span></span><span style=display:flex><span>86768   13020011107039 2021-03-24 15:52:24  B5   2  FQL966          4
</span></span><span style=display:flex><span>276370  13020011107039 2021-08-26 11:00:00  B5   2  FHE101          4
</span></span><span style=display:flex><span>341564  13020011107039 2021-10-22 12:44:53  B4   1  C659X1          4
</span></span><span style=display:flex><span>436506  13020011107039 2022-01-10 10:51:46  B3   2  C976DZ          4
</span></span><span style=display:flex><span>106173  13060117599649 2021-04-09 13:50:47  B4   1  CKW292          4
</span></span><span style=display:flex><span>141012  13060117599649 2021-05-10 10:34:02  B5   2  ED5419          4
</span></span></code></pre></div><p>将 <code>trade_more_than_tree_times_df</code> 去重以后, 就得到了一年内交易超过3次的车辆数量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_more_than_three_times_df<span style=color:#f92672>.</span>drop_duplicates(<span style=color:#e6db74>&#39;xh&#39;</span>)
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>                    xh                slrq  yw syq    hphm  trade_cnt
</span></span><span style=display:flex><span>61      31000014377490 2021-01-04 08:53:57  B4   1    None          4
</span></span><span style=display:flex><span>170     31000014101181 2021-01-04 09:23:19  B3   2  C7U7U5          4
</span></span><span style=display:flex><span>311     31099411060792 2021-01-04 09:52:37  B5   2  FNH521         96
</span></span><span style=display:flex><span>329     31000002544347 2021-01-04 09:56:29  B5   1  EBX530          7
</span></span><span style=display:flex><span>616     31000006106661 2021-01-04 10:48:47  B5   2  DTW260         41
</span></span><span style=display:flex><span>...                ...                 ...  ..  ..     ...        ...
</span></span><span style=display:flex><span>480115  31000006029250 2022-02-25 15:45:30  B5   2  DQL190         12
</span></span><span style=display:flex><span>481389  31000009821209 2022-02-28 12:31:12  B5   2  FXE617         10
</span></span><span style=display:flex><span>484869  31000007568261 2022-03-02 09:43:45  B3   2  EHX595          5
</span></span><span style=display:flex><span>486587  31000013145796 2022-03-03 09:48:59  B5   2  EJE228         10
</span></span><span style=display:flex><span>487427  31000007054104 2022-03-03 13:22:57  B5   2  EGQ176          7
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>[1762 rows x 6 columns]
</span></span></code></pre></div><p>根据 <code>syq</code> 来统计数量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_more_than_three_times_df<span style=color:#f92672>.</span>drop_duplicates(<span style=color:#e6db74>&#39;xh&#39;</span>)<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;syq&#39;</span>)[<span style=color:#e6db74>&#39;syq&#39;</span>]<span style=color:#f92672>.</span>count()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>syq
</span></span><span style=display:flex><span>1    805
</span></span><span style=display:flex><span>2    957
</span></span><span style=display:flex><span>Name: syq, dtype: int64
</span></span></code></pre></div><p>根据 <code>syq</code> 统计洗澡车一共交易的数量</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>trade_more_than_three_times_df<span style=color:#f92672>.</span>groupby(<span style=color:#e6db74>&#39;syq&#39;</span>)[<span style=color:#e6db74>&#39;syq&#39;</span>]<span style=color:#f92672>.</span>count()
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>syq
</span></span><span style=display:flex><span>1     4130
</span></span><span style=display:flex><span>2    12246
</span></span><span style=display:flex><span>Name: syq, dtype: int64
</span></span></code></pre></div><h3 id=结论>结论</h3><table><thead><tr><th></th><th>3个月内再次交易的数量 (辆)</th><th>洗澡车数量 ( 辆 )</th><th>洗澡车交易量 (次)</th></tr></thead><tbody><tr><td>单位</td><td>62358</td><td>805</td><td>4130</td></tr><tr><td>个人</td><td>30981</td><td>957</td><td>12246</td></tr></tbody></table><ul class=pa0></ul><div class="mt6 instapaper_ignoref"></div></div><aside class="w-30-l mt6-l"></aside></article></main><footer class="bg-black bottom-0 w-100 pa3" role=contentinfo><div class="flex justify-between"><a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href=https://shjanken.github.io/>&copy; shjanken's 兴趣小窝 2022</a><div><div class=ananke-socials></div></div></div></footer></body></html>